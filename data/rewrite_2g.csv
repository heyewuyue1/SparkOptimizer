id;sql;rewrite_sql
0;with year_total as ( select c_customer_id customer_id ,c_first_name customer_first_name ,c_last_name customer_last_name ,c_preferred_cust_flag customer_preferred_cust_flag ,c_birth_country customer_birth_country ,c_login customer_login ,c_email_address customer_email_address ,d_year dyear ,sum(((ss_ext_list_price-ss_ext_wholesale_cost-ss_ext_discount_amt)+ss_ext_sales_price)/2) year_total ,'s' sale_type from customer ,store_sales ,date_dim where c_customer_sk = ss_customer_sk and ss_sold_date_sk = d_date_sk group by c_customer_id ,c_first_name ,c_last_name ,c_preferred_cust_flag ,c_birth_country ,c_login ,c_email_address ,d_year union all select c_customer_id customer_id ,c_first_name customer_first_name ,c_last_name customer_last_name ,c_preferred_cust_flag customer_preferred_cust_flag ,c_birth_country customer_birth_country ,c_login customer_login ,c_email_address customer_email_address ,d_year dyear ,sum((((cs_ext_list_price-cs_ext_wholesale_cost-cs_ext_discount_amt)+cs_ext_sales_price)/2) ) year_total ,'c' sale_type from customer ,catalog_sales ,date_dim where c_customer_sk = cs_bill_customer_sk and cs_sold_date_sk = d_date_sk group by c_customer_id ,c_first_name ,c_last_name ,c_preferred_cust_flag ,c_birth_country ,c_login ,c_email_address ,d_year union all select c_customer_id customer_id ,c_first_name customer_first_name ,c_last_name customer_last_name ,c_preferred_cust_flag customer_preferred_cust_flag ,c_birth_country customer_birth_country ,c_login customer_login ,c_email_address customer_email_address ,d_year dyear ,sum((((ws_ext_list_price-ws_ext_wholesale_cost-ws_ext_discount_amt)+ws_ext_sales_price)/2) ) year_total ,'w' sale_type from customer ,web_sales ,date_dim where c_customer_sk = ws_bill_customer_sk and ws_sold_date_sk = d_date_sk group by c_customer_id ,c_first_name ,c_last_name ,c_preferred_cust_flag ,c_birth_country ,c_login ,c_email_address ,d_year ) select t_s_secyear.customer_id ,t_s_secyear.customer_first_name ,t_s_secyear.customer_last_name ,t_s_secyear.customer_email_address from year_total t_s_firstyear ,year_total t_s_secyear ,year_total t_c_firstyear ,year_total t_c_secyear ,year_total t_w_firstyear ,year_total t_w_secyear where t_s_secyear.customer_id = t_s_firstyear.customer_id and t_s_firstyear.customer_id = t_c_secyear.customer_id and t_s_firstyear.customer_id = t_c_firstyear.customer_id and t_s_firstyear.customer_id = t_w_firstyear.customer_id and t_s_firstyear.customer_id = t_w_secyear.customer_id and t_s_firstyear.sale_type = 's' and t_c_firstyear.sale_type = 'c' and t_w_firstyear.sale_type = 'w' and t_s_secyear.sale_type = 's' and t_c_secyear.sale_type = 'c' and t_w_secyear.sale_type = 'w' and t_s_firstyear.dyear = 2001 and t_s_secyear.dyear = 2001+1 and t_c_firstyear.dyear = 2001 and t_c_secyear.dyear = 2001+1 and t_w_firstyear.dyear = 2001 and t_w_secyear.dyear = 2001+1 and t_s_firstyear.year_total > 0 and t_c_firstyear.year_total > 0 and t_w_firstyear.year_total > 0 and case when t_c_firstyear.year_total > 0 then t_c_secyear.year_total / t_c_firstyear.year_total else null end > case when t_s_firstyear.year_total > 0 then t_s_secyear.year_total / t_s_firstyear.year_total else null end and case when t_c_firstyear.year_total > 0 then t_c_secyear.year_total / t_c_firstyear.year_total else null end > case when t_w_firstyear.year_total > 0 then t_w_secyear.year_total / t_w_firstyear.year_total else null end order by t_s_secyear.customer_id ,t_s_secyear.customer_first_name ,t_s_secyear.customer_last_name ,t_s_secyear.customer_email_address limit 100;SELECT t26.customer_id, t26.customer_first_name, t26.customer_last_name, t26.customer_email_address FROM (SELECT * FROM (SELECT customer.c_customer_id AS customer_id, customer.c_first_name AS customer_first_name, customer.c_last_name AS customer_last_name, customer.c_preferred_cust_flag AS customer_preferred_cust_flag, customer.c_birth_country AS customer_birth_country, customer.c_login AS customer_login, customer.c_email_address AS customer_email_address, date_dim.d_year AS dyear, SUM((store_sales.ss_ext_list_price - store_sales.ss_ext_wholesale_cost - store_sales.ss_ext_discount_amt + store_sales.ss_ext_sales_price) / 2) AS year_total, 's' AS sale_type FROM customer, store_sales, date_dim WHERE customer.c_customer_sk = store_sales.ss_customer_sk AND store_sales.ss_sold_date_sk = date_dim.d_date_sk GROUP BY customer.c_customer_id, customer.c_first_name, customer.c_last_name, customer.c_preferred_cust_flag, customer.c_birth_country, customer.c_login, customer.c_email_address, date_dim.d_year UNION ALL SELECT customer0.c_customer_id AS customer_id, customer0.c_first_name AS customer_first_name, customer0.c_last_name AS customer_last_name, customer0.c_preferred_cust_flag AS customer_preferred_cust_flag, customer0.c_birth_country AS customer_birth_country, customer0.c_login AS customer_login, customer0.c_email_address AS customer_email_address, date_dim0.d_year AS dyear, SUM((catalog_sales.cs_ext_list_price - catalog_sales.cs_ext_wholesale_cost - catalog_sales.cs_ext_discount_amt + catalog_sales.cs_ext_sales_price) / 2) AS year_total, 'c' AS sale_type FROM customer AS customer0, catalog_sales, date_dim AS date_dim0 WHERE customer0.c_customer_sk = catalog_sales.cs_bill_customer_sk AND catalog_sales.cs_sold_date_sk = date_dim0.d_date_sk GROUP BY customer0.c_customer_id, customer0.c_first_name, customer0.c_last_name, customer0.c_preferred_cust_flag, customer0.c_birth_country, customer0.c_login, customer0.c_email_address, date_dim0.d_year) AS t UNION ALL SELECT customer1.c_customer_id AS customer_id, customer1.c_first_name AS customer_first_name, customer1.c_last_name AS customer_last_name, customer1.c_preferred_cust_flag AS customer_preferred_cust_flag, customer1.c_birth_country AS customer_birth_country, customer1.c_login AS customer_login, customer1.c_email_address AS customer_email_address, date_dim1.d_year AS dyear, SUM((web_sales.ws_ext_list_price - web_sales.ws_ext_wholesale_cost - web_sales.ws_ext_discount_amt + web_sales.ws_ext_sales_price) / 2) AS year_total, 'w' AS sale_type FROM customer AS customer1, web_sales, date_dim AS date_dim1 WHERE customer1.c_customer_sk = web_sales.ws_bill_customer_sk AND web_sales.ws_sold_date_sk = date_dim1.d_date_sk GROUP BY customer1.c_customer_id, customer1.c_first_name, customer1.c_last_name, customer1.c_preferred_cust_flag, customer1.c_birth_country, customer1.c_login, customer1.c_email_address, date_dim1.d_year) AS t12, (SELECT * FROM (SELECT customer2.c_customer_id AS customer_id, customer2.c_first_name AS customer_first_name, customer2.c_last_name AS customer_last_name, customer2.c_preferred_cust_flag AS customer_preferred_cust_flag, customer2.c_birth_country AS customer_birth_country, customer2.c_login AS customer_login, customer2.c_email_address AS customer_email_address, date_dim2.d_year AS dyear, SUM((store_sales0.ss_ext_list_price - store_sales0.ss_ext_wholesale_cost - store_sales0.ss_ext_discount_amt + store_sales0.ss_ext_sales_price) / 2) AS year_total, 's' AS sale_type FROM customer AS customer2, store_sales AS store_sales0, date_dim AS date_dim2 WHERE customer2.c_customer_sk = store_sales0.ss_customer_sk AND store_sales0.ss_sold_date_sk = date_dim2.d_date_sk GROUP BY customer2.c_customer_id, customer2.c_first_name, customer2.c_last_name, customer2.c_preferred_cust_flag, customer2.c_birth_country, customer2.c_login, customer2.c_email_address, date_dim2.d_year UNION ALL SELECT customer3.c_customer_id AS customer_id, customer3.c_first_name AS customer_first_name, customer3.c_last_name AS customer_last_name, customer3.c_preferred_cust_flag AS customer_preferred_cust_flag, customer3.c_birth_country AS customer_birth_country, customer3.c_login AS customer_login, customer3.c_email_address AS customer_email_address, date_dim3.d_year AS dyear, SUM((catalog_sales0.cs_ext_list_price - catalog_sales0.cs_ext_wholesale_cost - catalog_sales0.cs_ext_discount_amt + catalog_sales0.cs_ext_sales_price) / 2) AS year_total, 'c' AS sale_type FROM customer AS customer3, catalog_sales AS catalog_sales0, date_dim AS date_dim3 WHERE customer3.c_customer_sk = catalog_sales0.cs_bill_customer_sk AND catalog_sales0.cs_sold_date_sk = date_dim3.d_date_sk GROUP BY customer3.c_customer_id, customer3.c_first_name, customer3.c_last_name, customer3.c_preferred_cust_flag, customer3.c_birth_country, customer3.c_login, customer3.c_email_address, date_dim3.d_year) AS t UNION ALL SELECT customer4.c_customer_id AS customer_id, customer4.c_first_name AS customer_first_name, customer4.c_last_name AS customer_last_name, customer4.c_preferred_cust_flag AS customer_preferred_cust_flag, customer4.c_birth_country AS customer_birth_country, customer4.c_login AS customer_login, customer4.c_email_address AS customer_email_address, date_dim4.d_year AS dyear, SUM((web_sales0.ws_ext_list_price - web_sales0.ws_ext_wholesale_cost - web_sales0.ws_ext_discount_amt + web_sales0.ws_ext_sales_price) / 2) AS year_total, 'w' AS sale_type FROM customer AS customer4, web_sales AS web_sales0, date_dim AS date_dim4 WHERE customer4.c_customer_sk = web_sales0.ws_bill_customer_sk AND web_sales0.ws_sold_date_sk = date_dim4.d_date_sk GROUP BY customer4.c_customer_id, customer4.c_first_name, customer4.c_last_name, customer4.c_preferred_cust_flag, customer4.c_birth_country, customer4.c_login, customer4.c_email_address, date_dim4.d_year) AS t26, (SELECT * FROM (SELECT customer5.c_customer_id AS customer_id, customer5.c_first_name AS customer_first_name, customer5.c_last_name AS customer_last_name, customer5.c_preferred_cust_flag AS customer_preferred_cust_flag, customer5.c_birth_country AS customer_birth_country, customer5.c_login AS customer_login, customer5.c_email_address AS customer_email_address, date_dim5.d_year AS dyear, SUM((store_sales1.ss_ext_list_price - store_sales1.ss_ext_wholesale_cost - store_sales1.ss_ext_discount_amt + store_sales1.ss_ext_sales_price) / 2) AS year_total, 's' AS sale_type FROM customer AS customer5, store_sales AS store_sales1, date_dim AS date_dim5 WHERE customer5.c_customer_sk = store_sales1.ss_customer_sk AND store_sales1.ss_sold_date_sk = date_dim5.d_date_sk GROUP BY customer5.c_customer_id, customer5.c_first_name, customer5.c_last_name, customer5.c_preferred_cust_flag, customer5.c_birth_country, customer5.c_login, customer5.c_email_address, date_dim5.d_year UNION ALL SELECT customer6.c_customer_id AS customer_id, customer6.c_first_name AS customer_first_name, customer6.c_last_name AS customer_last_name, customer6.c_preferred_cust_flag AS customer_preferred_cust_flag, customer6.c_birth_country AS customer_birth_country, customer6.c_login AS customer_login, customer6.c_email_address AS customer_email_address, date_dim6.d_year AS dyear, SUM((catalog_sales1.cs_ext_list_price - catalog_sales1.cs_ext_wholesale_cost - catalog_sales1.cs_ext_discount_amt + catalog_sales1.cs_ext_sales_price) / 2) AS year_total, 'c' AS sale_type FROM customer AS customer6, catalog_sales AS catalog_sales1, date_dim AS date_dim6 WHERE customer6.c_customer_sk = catalog_sales1.cs_bill_customer_sk AND catalog_sales1.cs_sold_date_sk = date_dim6.d_date_sk GROUP BY customer6.c_customer_id, customer6.c_first_name, customer6.c_last_name, customer6.c_preferred_cust_flag, customer6.c_birth_country, customer6.c_login, customer6.c_email_address, date_dim6.d_year) AS t UNION ALL SELECT customer7.c_customer_id AS customer_id, customer7.c_first_name AS customer_first_name, customer7.c_last_name AS customer_last_name, customer7.c_preferred_cust_flag AS customer_preferred_cust_flag, customer7.c_birth_country AS customer_birth_country, customer7.c_login AS customer_login, customer7.c_email_address AS customer_email_address, date_dim7.d_year AS dyear, SUM((web_sales1.ws_ext_list_price - web_sales1.ws_ext_wholesale_cost - web_sales1.ws_ext_discount_amt + web_sales1.ws_ext_sales_price) / 2) AS year_total, 'w' AS sale_type FROM customer AS customer7, web_sales AS web_sales1, date_dim AS date_dim7 WHERE customer7.c_customer_sk = web_sales1.ws_bill_customer_sk AND web_sales1.ws_sold_date_sk = date_dim7.d_date_sk GROUP BY customer7.c_customer_id, customer7.c_first_name, customer7.c_last_name, customer7.c_preferred_cust_flag, customer7.c_birth_country, customer7.c_login, customer7.c_email_address, date_dim7.d_year) AS t40, (SELECT * FROM (SELECT customer8.c_customer_id AS customer_id, customer8.c_first_name AS customer_first_name, customer8.c_last_name AS customer_last_name, customer8.c_preferred_cust_flag AS customer_preferred_cust_flag, customer8.c_birth_country AS customer_birth_country, customer8.c_login AS customer_login, customer8.c_email_address AS customer_email_address, date_dim8.d_year AS dyear, SUM((store_sales2.ss_ext_list_price - store_sales2.ss_ext_wholesale_cost - store_sales2.ss_ext_discount_amt + store_sales2.ss_ext_sales_price) / 2) AS year_total, 's' AS sale_type FROM customer AS customer8, store_sales AS store_sales2, date_dim AS date_dim8 WHERE customer8.c_customer_sk = store_sales2.ss_customer_sk AND store_sales2.ss_sold_date_sk = date_dim8.d_date_sk GROUP BY customer8.c_customer_id, customer8.c_first_name, customer8.c_last_name, customer8.c_preferred_cust_flag, customer8.c_birth_country, customer8.c_login, customer8.c_email_address, date_dim8.d_year UNION ALL SELECT customer9.c_customer_id AS customer_id, customer9.c_first_name AS customer_first_name, customer9.c_last_name AS customer_last_name, customer9.c_preferred_cust_flag AS customer_preferred_cust_flag, customer9.c_birth_country AS customer_birth_country, customer9.c_login AS customer_login, customer9.c_email_address AS customer_email_address, date_dim9.d_year AS dyear, SUM((catalog_sales2.cs_ext_list_price - catalog_sales2.cs_ext_wholesale_cost - catalog_sales2.cs_ext_discount_amt + catalog_sales2.cs_ext_sales_price) / 2) AS year_total, 'c' AS sale_type FROM customer AS customer9, catalog_sales AS catalog_sales2, date_dim AS date_dim9 WHERE customer9.c_customer_sk = catalog_sales2.cs_bill_customer_sk AND catalog_sales2.cs_sold_date_sk = date_dim9.d_date_sk GROUP BY customer9.c_customer_id, customer9.c_first_name, customer9.c_last_name, customer9.c_preferred_cust_flag, customer9.c_birth_country, customer9.c_login, customer9.c_email_address, date_dim9.d_year) AS t UNION ALL SELECT customer10.c_customer_id AS customer_id, customer10.c_first_name AS customer_first_name, customer10.c_last_name AS customer_last_name, customer10.c_preferred_cust_flag AS customer_preferred_cust_flag, customer10.c_birth_country AS customer_birth_country, customer10.c_login AS customer_login, customer10.c_email_address AS customer_email_address, date_dim10.d_year AS dyear, SUM((web_sales2.ws_ext_list_price - web_sales2.ws_ext_wholesale_cost - web_sales2.ws_ext_discount_amt + web_sales2.ws_ext_sales_price) / 2) AS year_total, 'w' AS sale_type FROM customer AS customer10, web_sales AS web_sales2, date_dim AS date_dim10 WHERE customer10.c_customer_sk = web_sales2.ws_bill_customer_sk AND web_sales2.ws_sold_date_sk = date_dim10.d_date_sk GROUP BY customer10.c_customer_id, customer10.c_first_name, customer10.c_last_name, customer10.c_preferred_cust_flag, customer10.c_birth_country, customer10.c_login, customer10.c_email_address, date_dim10.d_year) AS t54, (SELECT * FROM (SELECT customer11.c_customer_id AS customer_id, customer11.c_first_name AS customer_first_name, customer11.c_last_name AS customer_last_name, customer11.c_preferred_cust_flag AS customer_preferred_cust_flag, customer11.c_birth_country AS customer_birth_country, customer11.c_login AS customer_login, customer11.c_email_address AS customer_email_address, date_dim11.d_year AS dyear, SUM((store_sales3.ss_ext_list_price - store_sales3.ss_ext_wholesale_cost - store_sales3.ss_ext_discount_amt + store_sales3.ss_ext_sales_price) / 2) AS year_total, 's' AS sale_type FROM customer AS customer11, store_sales AS store_sales3, date_dim AS date_dim11 WHERE customer11.c_customer_sk = store_sales3.ss_customer_sk AND store_sales3.ss_sold_date_sk = date_dim11.d_date_sk GROUP BY customer11.c_customer_id, customer11.c_first_name, customer11.c_last_name, customer11.c_preferred_cust_flag, customer11.c_birth_country, customer11.c_login, customer11.c_email_address, date_dim11.d_year UNION ALL SELECT customer12.c_customer_id AS customer_id, customer12.c_first_name AS customer_first_name, customer12.c_last_name AS customer_last_name, customer12.c_preferred_cust_flag AS customer_preferred_cust_flag, customer12.c_birth_country AS customer_birth_country, customer12.c_login AS customer_login, customer12.c_email_address AS customer_email_address, date_dim12.d_year AS dyear, SUM((catalog_sales3.cs_ext_list_price - catalog_sales3.cs_ext_wholesale_cost - catalog_sales3.cs_ext_discount_amt + catalog_sales3.cs_ext_sales_price) / 2) AS year_total, 'c' AS sale_type FROM customer AS customer12, catalog_sales AS catalog_sales3, date_dim AS date_dim12 WHERE customer12.c_customer_sk = catalog_sales3.cs_bill_customer_sk AND catalog_sales3.cs_sold_date_sk = date_dim12.d_date_sk GROUP BY customer12.c_customer_id, customer12.c_first_name, customer12.c_last_name, customer12.c_preferred_cust_flag, customer12.c_birth_country, customer12.c_login, customer12.c_email_address, date_dim12.d_year) AS t UNION ALL SELECT customer13.c_customer_id AS customer_id, customer13.c_first_name AS customer_first_name, customer13.c_last_name AS customer_last_name, customer13.c_preferred_cust_flag AS customer_preferred_cust_flag, customer13.c_birth_country AS customer_birth_country, customer13.c_login AS customer_login, customer13.c_email_address AS customer_email_address, date_dim13.d_year AS dyear, SUM((web_sales3.ws_ext_list_price - web_sales3.ws_ext_wholesale_cost - web_sales3.ws_ext_discount_amt + web_sales3.ws_ext_sales_price) / 2) AS year_total, 'w' AS sale_type FROM customer AS customer13, web_sales AS web_sales3, date_dim AS date_dim13 WHERE customer13.c_customer_sk = web_sales3.ws_bill_customer_sk AND web_sales3.ws_sold_date_sk = date_dim13.d_date_sk GROUP BY customer13.c_customer_id, customer13.c_first_name, customer13.c_last_name, customer13.c_preferred_cust_flag, customer13.c_birth_country, customer13.c_login, customer13.c_email_address, date_dim13.d_year) AS t68, (SELECT * FROM (SELECT customer14.c_customer_id AS customer_id, customer14.c_first_name AS customer_first_name, customer14.c_last_name AS customer_last_name, customer14.c_preferred_cust_flag AS customer_preferred_cust_flag, customer14.c_birth_country AS customer_birth_country, customer14.c_login AS customer_login, customer14.c_email_address AS customer_email_address, date_dim14.d_year AS dyear, SUM((store_sales4.ss_ext_list_price - store_sales4.ss_ext_wholesale_cost - store_sales4.ss_ext_discount_amt + store_sales4.ss_ext_sales_price) / 2) AS year_total, 's' AS sale_type FROM customer AS customer14, store_sales AS store_sales4, date_dim AS date_dim14 WHERE customer14.c_customer_sk = store_sales4.ss_customer_sk AND store_sales4.ss_sold_date_sk = date_dim14.d_date_sk GROUP BY customer14.c_customer_id, customer14.c_first_name, customer14.c_last_name, customer14.c_preferred_cust_flag, customer14.c_birth_country, customer14.c_login, customer14.c_email_address, date_dim14.d_year UNION ALL SELECT customer15.c_customer_id AS customer_id, customer15.c_first_name AS customer_first_name, customer15.c_last_name AS customer_last_name, customer15.c_preferred_cust_flag AS customer_preferred_cust_flag, customer15.c_birth_country AS customer_birth_country, customer15.c_login AS customer_login, customer15.c_email_address AS customer_email_address, date_dim15.d_year AS dyear, SUM((catalog_sales4.cs_ext_list_price - catalog_sales4.cs_ext_wholesale_cost - catalog_sales4.cs_ext_discount_amt + catalog_sales4.cs_ext_sales_price) / 2) AS year_total, 'c' AS sale_type FROM customer AS customer15, catalog_sales AS catalog_sales4, date_dim AS date_dim15 WHERE customer15.c_customer_sk = catalog_sales4.cs_bill_customer_sk AND catalog_sales4.cs_sold_date_sk = date_dim15.d_date_sk GROUP BY customer15.c_customer_id, customer15.c_first_name, customer15.c_last_name, customer15.c_preferred_cust_flag, customer15.c_birth_country, customer15.c_login, customer15.c_email_address, date_dim15.d_year) AS t UNION ALL SELECT customer16.c_customer_id AS customer_id, customer16.c_first_name AS customer_first_name, customer16.c_last_name AS customer_last_name, customer16.c_preferred_cust_flag AS customer_preferred_cust_flag, customer16.c_birth_country AS customer_birth_country, customer16.c_login AS customer_login, customer16.c_email_address AS customer_email_address, date_dim16.d_year AS dyear, SUM((web_sales4.ws_ext_list_price - web_sales4.ws_ext_wholesale_cost - web_sales4.ws_ext_discount_amt + web_sales4.ws_ext_sales_price) / 2) AS year_total, 'w' AS sale_type FROM customer AS customer16, web_sales AS web_sales4, date_dim AS date_dim16 WHERE customer16.c_customer_sk = web_sales4.ws_bill_customer_sk AND web_sales4.ws_sold_date_sk = date_dim16.d_date_sk GROUP BY customer16.c_customer_id, customer16.c_first_name, customer16.c_last_name, customer16.c_preferred_cust_flag, customer16.c_birth_country, customer16.c_login, customer16.c_email_address, date_dim16.d_year) AS t82 WHERE t26.customer_id = t12.customer_id AND t12.customer_id = t54.customer_id AND (t12.customer_id = t40.customer_id AND (t12.customer_id = t68.customer_id AND t12.customer_id = t82.customer_id)) AND (t12.sale_type = 's' AND (t40.sale_type = 'c' AND t68.sale_type = 'w') AND (t26.sale_type = 's' AND (t54.sale_type = 'c' AND t82.sale_type = 'w'))) AND (t12.dyear = 2001 AND t26.dyear = 2001 + 1 AND (t40.dyear = 2001 AND (t54.dyear = 2001 + 1 AND t68.dyear = 2001)) AND (t82.dyear = 2001 + 1 AND (t12.year_total > 0 AND t40.year_total > 0) AND (t68.year_total > 0 AND (CASE WHEN t12.year_total > 0 THEN CASE WHEN t40.year_total > 0 THEN t54.year_total / t40.year_total > t26.year_total / t12.year_total ELSE FALSE END ELSE FALSE END AND CASE WHEN t68.year_total > 0 THEN CASE WHEN t40.year_total > 0 THEN t54.year_total / t40.year_total > t82.year_total / t68.year_total ELSE FALSE END ELSE FALSE END)))) ORDER BY t26.customer_id, t26.customer_first_name, t26.customer_last_name, t26.customer_email_address LIMIT 100
1;with ssr as (select s_store_id, sum(sales_price) as sales, sum(profit) as profit, sum(return_amt) as returns, sum(net_loss) as profit_loss from ( select ss_store_sk as store_sk, ss_sold_date_sk as date_sk, ss_ext_sales_price as sales_price, ss_net_profit as profit, cast(0 as decimal(7,2)) as return_amt, cast(0 as decimal(7,2)) as net_loss from store_sales union all select sr_store_sk as store_sk, sr_returned_date_sk as date_sk, cast(0 as decimal(7,2)) as sales_price, cast(0 as decimal(7,2)) as profit, sr_return_amt as return_amt, sr_net_loss as net_loss from store_returns ) salesreturns, date_dim, store where date_sk = d_date_sk and d_date between cast('1998-08-04' as date) and (cast('1998-08-04' as date) + interval 14 days) and store_sk = s_store_sk group by s_store_id) , csr as (select cp_catalog_page_id, sum(sales_price) as sales, sum(profit) as profit, sum(return_amt) as returns, sum(net_loss) as profit_loss from ( select cs_catalog_page_sk as page_sk, cs_sold_date_sk as date_sk, cs_ext_sales_price as sales_price, cs_net_profit as profit, cast(0 as decimal(7,2)) as return_amt, cast(0 as decimal(7,2)) as net_loss from catalog_sales union all select cr_catalog_page_sk as page_sk, cr_returned_date_sk as date_sk, cast(0 as decimal(7,2)) as sales_price, cast(0 as decimal(7,2)) as profit, cr_return_amount as return_amt, cr_net_loss as net_loss from catalog_returns ) salesreturns, date_dim, catalog_page where date_sk = d_date_sk and d_date between cast('1998-08-04' as date) and (cast('1998-08-04' as date) + interval 14 days) and page_sk = cp_catalog_page_sk group by cp_catalog_page_id) , wsr as (select web_site_id, sum(sales_price) as sales, sum(profit) as profit, sum(return_amt) as returns, sum(net_loss) as profit_loss from ( select ws_web_site_sk as wsr_web_site_sk, ws_sold_date_sk as date_sk, ws_ext_sales_price as sales_price, ws_net_profit as profit, cast(0 as decimal(7,2)) as return_amt, cast(0 as decimal(7,2)) as net_loss from web_sales union all select ws_web_site_sk as wsr_web_site_sk, wr_returned_date_sk as date_sk, cast(0 as decimal(7,2)) as sales_price, cast(0 as decimal(7,2)) as profit, wr_return_amt as return_amt, wr_net_loss as net_loss from web_returns left outer join web_sales on ( wr_item_sk = ws_item_sk and wr_order_number = ws_order_number) ) salesreturns, date_dim, web_site where date_sk = d_date_sk and d_date between cast('1998-08-04' as date) and (cast('1998-08-04' as date) + interval 14 days) and wsr_web_site_sk = web_site_sk group by web_site_id) select channel , id , sum(sales) as sales , sum(returns) as returns , sum(profit) as profit from (select 'store channel' as channel , 'store' || s_store_id as id , sales , returns , (profit - profit_loss) as profit from ssr union all select 'catalog channel' as channel , 'catalog_page' || cp_catalog_page_id as id , sales , returns , (profit - profit_loss) as profit from csr union all select 'web channel' as channel , 'web_site' || web_site_id as id , sales , returns , (profit - profit_loss) as profit from wsr ) x group by rollup (channel, id) order by channel ,id limit 100;SELECT channel, id, SUM(sales) AS sales, SUM(calcite_returns) AS calcite_returns, SUM(profit) AS profit FROM (SELECT * FROM (SELECT 'store channel' AS channel, 'store' || store.s_store_id AS id, SUM(t1.sales_price) AS sales, SUM(t1.return_amt) AS calcite_returns, SUM(t1.profit) - SUM(t1.net_loss) AS profit FROM (SELECT ss_store_sk AS store_sk, ss_sold_date_sk AS date_sk, ss_ext_sales_price AS sales_price, ss_net_profit AS profit, 0 AS return_amt, 0 AS net_loss FROM store_sales UNION ALL SELECT sr_store_sk AS store_sk, sr_returned_date_sk AS date_sk, 0 AS sales_price, 0 AS profit, sr_return_amt AS return_amt, sr_net_loss AS net_loss FROM store_returns) AS t1 INNER JOIN (SELECT * FROM date_dim WHERE d_date >= DATE '1998-08-04' AND d_date <= (DATE '1998-08-04' + 14 * INTERVAL '1' DAY)) AS t2 ON t1.date_sk = t2.d_date_sk INNER JOIN store ON t1.store_sk = store.s_store_sk GROUP BY store.s_store_id UNION ALL SELECT 'catalog channel' AS channel, 'catalog_page' || catalog_page.cp_catalog_page_id AS id, SUM(t8.sales_price) AS sales, SUM(t8.return_amt) AS calcite_returns, SUM(t8.profit) - SUM(t8.net_loss) AS profit FROM (SELECT cs_catalog_page_sk AS page_sk, cs_sold_date_sk AS date_sk, cs_ext_sales_price AS sales_price, cs_net_profit AS profit, 0 AS return_amt, 0 AS net_loss FROM catalog_sales UNION ALL SELECT cr_catalog_page_sk AS page_sk, cr_returned_date_sk AS date_sk, 0 AS sales_price, 0 AS profit, cr_return_amount AS return_amt, cr_net_loss AS net_loss FROM catalog_returns) AS t8 INNER JOIN (SELECT * FROM date_dim WHERE d_date >= DATE '1998-08-04' AND d_date <= (DATE '1998-08-04' + 14 * INTERVAL '1' DAY)) AS t9 ON t8.date_sk = t9.d_date_sk INNER JOIN catalog_page ON t8.page_sk = catalog_page.cp_catalog_page_sk GROUP BY catalog_page.cp_catalog_page_id) AS t UNION ALL SELECT 'web channel' AS channel, 'web_site' || web_site.web_site_id AS id, SUM(t16.sales_price) AS sales, SUM(t16.return_amt) AS calcite_returns, SUM(t16.profit) - SUM(t16.net_loss) AS profit FROM (SELECT ws_web_site_sk AS wsr_web_site_sk, ws_sold_date_sk AS date_sk, ws_ext_sales_price AS sales_price, ws_net_profit AS profit, 0 AS return_amt, 0 AS net_loss FROM web_sales UNION ALL SELECT web_sales0.ws_web_site_sk AS wsr_web_site_sk, web_returns.wr_returned_date_sk AS date_sk, 0 AS sales_price, 0 AS profit, web_returns.wr_return_amt AS return_amt, web_returns.wr_net_loss AS net_loss FROM web_returns LEFT JOIN web_sales AS web_sales0 ON web_returns.wr_item_sk = web_sales0.ws_item_sk AND web_returns.wr_order_number = web_sales0.ws_order_number) AS t16 INNER JOIN (SELECT * FROM date_dim WHERE d_date >= DATE '1998-08-04' AND d_date <= (DATE '1998-08-04' + 14 * INTERVAL '1' DAY)) AS t17 ON t16.date_sk = t17.d_date_sk INNER JOIN web_site ON t16.wsr_web_site_sk = web_site.web_site_sk GROUP BY web_site.web_site_id) AS t21 GROUP BY ROLLUP(channel, id) ORDER BY channel, id LIMIT 100
